<!DOCTYPE html>
<html lang="tl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Carpinoy ‚Ä¢ Car Loan Application</title>
<link rel="icon" type="image/png" href="https://carpinoylogistics.com/favicon.png">
<link rel="stylesheet" href="carpinoy-theme.css">
<link rel="stylesheet" href="cp-brad-widget-v2.css">
<style>
/* ‚îÄ‚îÄ Dark 3D overrides for carloan form ‚îÄ‚îÄ */
:root{
  --cp-bg:#1a222e;--cp-card-flat:#252e3c;
  --cp-ink:rgba(255,255,255,0.9);--cp-ink-soft:rgba(255,255,255,0.55);
  --cp-border:rgba(255,255,255,0.08);--cp-lime:#c5cd27;--cp-lime-soft:rgba(197,205,39,.12);
  --cp-brick:#a06032;--cp-carton:#d78c5a;
  --cp-linkink:rgba(255,255,255,0.6);
  --cp-shadow:6px 6px 16px rgba(0,0,0,0.45),-4px -4px 12px rgba(255,255,255,0.03);
  --cp-radius:20px;
}
html,body{margin:0;padding:0;background:#1a222e;font-family:system-ui,-apple-system,sans-serif;overflow-x:hidden;color:var(--cp-ink);-webkit-font-smoothing:antialiased}
.white-wrap{background:#1e2734;border-radius:28px;width:min(1680px,calc(100vw - 28px));margin:14px auto;padding:clamp(12px,2.2vw,22px);box-shadow:0 10px 30px rgba(0,0,0,.20);border:1px solid rgba(255,255,255,.06)}
.wrap{max-width:1080px;margin:0 auto;padding-inline:14px}
.cp-card{background:#252e3c;border-radius:20px;border:1px solid rgba(255,255,255,0.08);box-shadow:6px 6px 16px rgba(0,0,0,0.45),-4px -4px 12px rgba(255,255,255,0.03);max-width:720px;width:100%;padding:clamp(14px,2.4vw,22px);text-align:left;position:relative;overflow:hidden;margin:0 auto 20px auto}
.cp-card::before{display:none!important}
.cp-title{font-weight:800;font-size:clamp(17px,2.7vw,23px);margin:0;color:rgba(255,255,255,0.9);text-align:center;background:linear-gradient(135deg,#fff 30%,#8a94a6);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cp-title-wrap{display:flex;align-items:center;justify-content:center;margin-bottom:8px;text-align:center;gap:8px}
.cp-dot{width:10px;height:10px;border-radius:50%;background:var(--cp-lime);box-shadow:0 0 8px rgba(197,205,39,.45)}
.cp-title-plate{display:inline-block;border-radius:14px;padding:6px 18px;background:linear-gradient(145deg,#2a3444,#232b39);border:1px solid rgba(255,255,255,0.08);box-shadow:6px 6px 16px rgba(0,0,0,0.4),-3px -3px 8px rgba(255,255,255,0.02),inset 0 1px 0 rgba(255,255,255,0.06)}
.cp-sub{font-size:clamp(12px,1.45vw,14px);line-height:1.7;margin:6px 0 10px;color:rgba(255,255,255,0.5);text-align:center}
@media(max-width:640px){.wrap{padding-inline:10px}.cp-card{padding:14px 12px}.cp-title-plate{padding-inline:10px}}

.caf-steps{display:flex;gap:4px;justify-content:center;margin:0 0 20px;flex-wrap:wrap}
.caf-step{display:flex;align-items:center;gap:4px;font-size:11px;font-weight:700;color:var(--cp-ink-soft);opacity:.5;transition:opacity .2s}
.caf-step.is-active{opacity:1;color:var(--cp-lime)}
.caf-step.is-done{opacity:.8;color:var(--cp-lime)}
.caf-step-num{width:24px;height:24px;border-radius:999px;display:grid;place-items:center;font-size:11px;font-weight:800;border:2px solid currentColor;background:transparent;transition:all .2s}
.caf-step.is-active .caf-step-num{background:var(--cp-lime);color:#111;border-color:var(--cp-lime)}
.caf-step.is-done .caf-step-num{background:var(--cp-lime);color:#111;border-color:var(--cp-lime)}
.caf-step-line{width:20px;height:2px;background:currentColor;opacity:.3}

/* Form panels */
.caf-panel{display:none}
.caf-panel.is-active{display:block;animation:cafFadeIn .3s ease-out}
@keyframes cafFadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* Section title */
.caf-section-title{font-size:15px;font-weight:800;margin:18px 0 10px;padding-bottom:6px;border-bottom:2px solid var(--cp-lime-soft);color:var(--cp-ink);display:flex;align-items:center;gap:8px}
.caf-section-title:first-child{margin-top:0}

/* Form fields */
.caf-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px 14px}
@media(max-width:600px){.caf-grid{grid-template-columns:1fr}}
.caf-field{display:flex;flex-direction:column;gap:3px}
.caf-field.full{grid-column:1/-1}
.caf-label{font-size:11.5px;font-weight:700;color:var(--cp-ink-soft);letter-spacing:.02em}
.caf-label .req{color:#e53e3e;margin-left:2px}
.caf-input{padding:9px 12px;border:1.5px solid rgba(255,255,255,0.12);border-radius:10px;font-size:13.5px;font-family:inherit;background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.9);outline:none;transition:border-color .2s,box-shadow .2s;width:100%}
.caf-input:focus{border-color:var(--cp-lime);box-shadow:0 0 0 3px rgba(197,205,39,.15)}
select.caf-input{cursor:pointer;appearance:auto}
textarea.caf-input{resize:vertical;min-height:60px}

/* Radio card for unit selection */
.caf-unit-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;margin:8px 0}
.caf-unit-card{position:relative;cursor:pointer;padding:12px 14px;border:2px solid rgba(255,255,255,0.1);border-radius:14px;background:rgba(255,255,255,0.04);transition:all .2s;display:flex;align-items:center;gap:10px}
.caf-unit-card:hover{border-color:rgba(197,205,39,.5);box-shadow:0 4px 12px rgba(0,0,0,.08)}
.caf-unit-card.is-selected{border-color:var(--cp-lime);background:var(--cp-lime-soft);box-shadow:0 0 0 3px rgba(197,205,39,.18)}
.caf-unit-card input{position:absolute;opacity:0;width:0;height:0}
.caf-unit-dot{width:18px;height:18px;border-radius:999px;border:2px solid var(--cp-border);flex-shrink:0;display:grid;place-items:center;transition:all .2s}
.caf-unit-card.is-selected .caf-unit-dot{border-color:var(--cp-lime);background:var(--cp-lime)}
.caf-unit-card.is-selected .caf-unit-dot::after{content:"‚úì";font-size:11px;font-weight:800;color:#111}
.caf-unit-name{font-size:13px;font-weight:700;color:var(--cp-ink);line-height:1.3}


/* Dark 3D form overrides */
.caf-label{color:rgba(255,255,255,0.55)!important}
.caf-input{background:rgba(255,255,255,0.06)!important;border-color:rgba(255,255,255,0.12)!important;color:rgba(255,255,255,0.9)!important}
.caf-input:focus{border-color:var(--cp-lime)!important;box-shadow:0 0 0 3px rgba(197,205,39,0.15)!important}
.caf-input::placeholder{color:rgba(255,255,255,0.25)}
.caf-section-title{color:rgba(255,255,255,0.9)!important;border-bottom-color:rgba(197,205,39,0.2)!important}
.caf-unit-card{background:rgba(255,255,255,0.04)!important;border-color:rgba(255,255,255,0.1)!important}
.caf-unit-card.is-selected{background:rgba(197,205,39,0.08)!important;border-color:#c5cd27!important}
.caf-unit-name{color:rgba(255,255,255,0.85)!important}
.caf-privacy{background:rgba(255,255,255,0.04)!important;border-color:rgba(255,255,255,0.1)!important}
.caf-privacy-text{color:rgba(255,255,255,0.5)!important}
.caf-privacy-check span{color:rgba(255,255,255,0.85)!important}
.caf-btn-back{border-color:rgba(255,255,255,0.12)!important;color:rgba(255,255,255,0.5)!important}
.caf-btn-back:hover{border-color:rgba(197,205,39,0.3)!important;color:rgba(255,255,255,0.8)!important}
.caf-error{color:#FF6B6B!important}
.caf-success h2{color:rgba(255,255,255,0.9)!important}
.caf-success p{color:rgba(255,255,255,0.5)!important}
select.caf-input option{background:#2a3444;color:rgba(255,255,255,0.9)}
.cp-footer-embossed{margin-top:20px;padding:10px 18px;text-align:center;font-weight:800;letter-spacing:.15px;color:rgba(255,255,255,0.25);font-size:11px}
.cp-section{margin-bottom:0}
.cp-switch{display:none!important}
</style>
</head>
<body>

<!-- NAV (same as all pages) -->
<nav class="cp-nav" id="cpNav"><div class="cp-nav__bar">
<a href="index.html"><img class="cp-nav__logo" src="https://carpinoylogistics.com/logo.png" alt="Carpinoy Logistics"></a>
<div class="cp-nav__links">
<a href="index.html">Home</a>
<a href="business-package.html">Business Package</a>
<a href="accredited-associates.html">Accredited Associates</a>
<a href="contact.html">Contact Us</a>
<a href="mission-vision.html">Mission &amp; Vision</a>
<a href="privacy-policy.html">Privacy Policy</a>
</div>
<a class="cp-nav__cta" href="carloan-application.html">Apply Now</a>
<button class="cp-nav__hamburger" id="cpHam" aria-label="Menu">&#9776;</button>
</div><div class="cp-nav__mobile" id="cpMob">
<a href="index.html">Home</a>
<a href="business-package.html">Business Package</a>
<a href="accredited-associates.html">Accredited Associates</a>
<a href="contact.html">Contact Us</a>
<a href="mission-vision.html">Mission &amp; Vision</a>
<a href="privacy-policy.html">Privacy Policy</a>
<a class="mob-cta" href="carloan-application.html">Apply Now &rarr;</a>
</div></nav>

<div style="height:70px"></div>

<div class="white-wrap">
<div class="wrap">
<section class="cp-section">
<article class="cp-card" style="max-width:720px">

<!-- Title -->
<div class="cp-title-wrap">
<span class="cp-dot"></span>
<span class="cp-title-plate"><h1 class="cp-title">üìã Car Loan Application</h1></span>
<span class="cp-dot"></span>
</div>
<p class="cp-sub">Carpinoy Business Package ‚Äî Authorized Dealership Car Loan</p>

<!-- Step indicator -->
<div class="caf-steps" id="cafSteps"></div>

<!-- Error message -->
<div class="caf-error" id="cafError"></div>

<!-- ‚ïê‚ïê‚ïê STEP 1: Unit Selection ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-1">
<div class="caf-section-title">üöõ Select Unit</div>
<div class="caf-unit-grid" id="unitGrid"></div>
</div>

<!-- ‚ïê‚ïê‚ïê STEP 2: Data Privacy Acceptance ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-2">
<div class="caf-section-title">üîí Data Privacy Waiver</div>
<div class="caf-privacy">
<div class="caf-privacy-text" id="privacyText"></div>
<label class="caf-privacy-check">
<input type="checkbox" id="privacyAccept"/>
<span>I have read and agree to the Data Privacy Act Waiver above.</span>
</label>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê STEP 3: Principal Information ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-3">
<div class="caf-section-title">üë§ Principal Applicant</div>
<div class="caf-grid">
<div class="caf-field"><label class="caf-label">First Name <span class="req">*</span></label><input class="caf-input" data-field="principal_firstname" required/></div>
<div class="caf-field"><label class="caf-label">Middle Name</label><input class="caf-input" data-field="principal_middlename"/></div>
<div class="caf-field"><label class="caf-label">Last Name <span class="req">*</span></label><input class="caf-input" data-field="principal_lastname" required/></div>
<div class="caf-field"><label class="caf-label">Birthday <span class="req">*</span></label><input class="caf-input" type="date" data-field="principal_birthday" required/></div>
<div class="caf-field"><label class="caf-label">Age</label><input class="caf-input" type="number" data-field="principal_age" min="18" max="99"/></div>
<div class="caf-field"><label class="caf-label">Civil Status <span class="req">*</span></label>
<select class="caf-input" data-field="principal_civil_status" required><option value="">Select‚Ä¶</option><option>Single</option><option>Married</option><option>Widowed</option><option>Separated</option></select></div>
<div class="caf-field"><label class="caf-label">Nationality</label><input class="caf-input" data-field="principal_nationality" value="Filipino"/></div>
<div class="caf-field"><label class="caf-label">Gender <span class="req">*</span></label>
<select class="caf-input" data-field="principal_gender" required><option value="">Select‚Ä¶</option><option>Male</option><option>Female</option></select></div>
<div class="caf-field"><label class="caf-label">TIN</label><input class="caf-input" data-field="principal_tin" placeholder="000-000-000-000"/></div>
<div class="caf-field"><label class="caf-label">Birth Place</label><input class="caf-input" data-field="principal_birth_place"/></div>
<div class="caf-field full"><label class="caf-label">Home Address <span class="req">*</span></label><input class="caf-input" data-field="principal_home_address" required/></div>
<div class="caf-field"><label class="caf-label">Residential Status</label>
<select class="caf-input" data-field="principal_residential_status"><option value="">Select‚Ä¶</option><option>Owned</option><option>Rented</option><option>Living with Relatives</option><option>Company Provided</option></select></div>
<div class="caf-field"><label class="caf-label">Years at Residence</label><input class="caf-input" type="number" data-field="principal_residential_years_live" min="0"/></div>
<div class="caf-field"><label class="caf-label">Home Phone</label><input class="caf-input" type="tel" data-field="principal_homephone_number"/></div>
<div class="caf-field"><label class="caf-label">Mobile Number <span class="req">*</span></label><input class="caf-input" type="tel" data-field="principal_mobilephone_number" required placeholder="09XX-XXX-XXXX"/></div>
<div class="caf-field"><label class="caf-label">Secondary Mobile</label><input class="caf-input" type="tel" data-field="principal_secondary_mobilephone"/></div>
<div class="caf-field"><label class="caf-label">Email Address <span class="req">*</span></label><input class="caf-input" type="email" data-field="principal_email_address" required/></div>
<div class="caf-field full"><label class="caf-label">Facebook Profile Link</label><input class="caf-input" type="url" data-field="principal_facebook_profile_link" placeholder="https://facebook.com/..."/></div>
<div class="caf-field"><label class="caf-label">Main Bank</label><input class="caf-input" data-field="principal_main_bank"/></div>
<div class="caf-field"><label class="caf-label">Mother's Maiden Name</label><input class="caf-input" data-field="principal_mothers_maiden_name"/></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê STEP 4: Employment / Business ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-4">
<div class="caf-section-title">üíº Employment / Business Info</div>
<div class="caf-grid">
<div class="caf-field"><label class="caf-label">Job/Business Status <span class="req">*</span></label>
<select class="caf-input" data-field="principal_job_business_status" required><option value="">Select‚Ä¶</option><option>Employed</option><option>Self-Employed</option><option>Business Owner</option><option>OFW</option><option>Freelancer</option><option>Retired</option></select></div>
<div class="caf-field"><label class="caf-label">Employer / Business Name <span class="req">*</span></label><input class="caf-input" data-field="principal_employer_name" required/></div>
<div class="caf-field full"><label class="caf-label">Job Description</label><input class="caf-input" data-field="principal_job_description"/></div>
<div class="caf-field"><label class="caf-label">Nature of Job/Business</label><input class="caf-input" data-field="principal_nature_job_business"/></div>
<div class="caf-field"><label class="caf-label">Tenure (years)</label><input class="caf-input" data-field="principal_job_tenure" placeholder="e.g. 3 years"/></div>
<div class="caf-field"><label class="caf-label">Monthly Income <span class="req">*</span></label><input class="caf-input" data-field="principal_monthly_income" required placeholder="‚Ç±"/></div>
<div class="caf-field"><label class="caf-label">Work Email</label><input class="caf-input" type="email" data-field="principal_job_business_email"/></div>
<div class="caf-field"><label class="caf-label">Work Phone</label><input class="caf-input" type="tel" data-field="principal_job_business_phone_number"/></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê STEP 5: Co-Maker ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-5">
<div class="caf-section-title">ü§ù Co-Maker / Co-Borrower</div>
<p style="font-size:12px;color:var(--cp-ink-soft);margin:0 0 12px">If not applicable, you may leave this section blank and proceed.</p>
<div class="caf-grid">
<div class="caf-field"><label class="caf-label">First Name</label><input class="caf-input" data-field="comaker_firstname"/></div>
<div class="caf-field"><label class="caf-label">Middle Name</label><input class="caf-input" data-field="comaker_middlename"/></div>
<div class="caf-field"><label class="caf-label">Last Name</label><input class="caf-input" data-field="comaker_lastname"/></div>
<div class="caf-field"><label class="caf-label">Gender</label>
<select class="caf-input" data-field="comaker_gender"><option value="">Select‚Ä¶</option><option>Male</option><option>Female</option></select></div>
<div class="caf-field"><label class="caf-label">Relation to Principal</label><input class="caf-input" data-field="comaker_relation_to_principal" placeholder="e.g. Spouse, Parent, Sibling"/></div>
<div class="caf-field"><label class="caf-label">TIN</label><input class="caf-input" data-field="comaker_tin"/></div>
<div class="caf-field"><label class="caf-label">Birth Place</label><input class="caf-input" data-field="comaker_birth_place"/></div>
<div class="caf-field"><label class="caf-label">Mobile Number</label><input class="caf-input" type="tel" data-field="comaker_mobile_number"/></div>
<div class="caf-field"><label class="caf-label">Email</label><input class="caf-input" type="email" data-field="comaker_email_address"/></div>
<div class="caf-field"><label class="caf-label">Job/Business Status</label>
<select class="caf-input" data-field="comaker_job_business_status"><option value="">Select‚Ä¶</option><option>Employed</option><option>Self-Employed</option><option>Business Owner</option><option>OFW</option><option>Freelancer</option><option>Retired</option></select></div>
<div class="caf-field"><label class="caf-label">Employer / Business Name</label><input class="caf-input" data-field="comaker_job_business_name"/></div>
<div class="caf-field"><label class="caf-label">Job Description</label><input class="caf-input" data-field="comaker_job_description"/></div>
<div class="caf-field"><label class="caf-label">Nature of Job/Business</label><input class="caf-input" data-field="comaker_job_business_nature"/></div>
<div class="caf-field"><label class="caf-label">Tenure</label><input class="caf-input" data-field="comaker_job_business_tenure"/></div>
<div class="caf-field"><label class="caf-label">Monthly Income</label><input class="caf-input" data-field="comaker_monthly_income" placeholder="‚Ç±"/></div>
<div class="caf-field"><label class="caf-label">Work Email</label><input class="caf-input" type="email" data-field="comaker_job_business_email"/></div>
<div class="caf-field"><label class="caf-label">Work Phone</label><input class="caf-input" type="tel" data-field="comaker_job_business_phone_number"/></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê STEP 6: References & Submit ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-6">
<div class="caf-section-title">üìá Character References</div>
<p style="font-size:12px;color:var(--cp-ink-soft);margin:0 0 12px">Please provide 3 character references (Name, Mobile, Address).</p>
<div class="caf-grid">
<div class="caf-field full"><label class="caf-label">Reference 1 ‚Äî Name / Mobile / Address <span class="req">*</span></label><input class="caf-input" data-field="principal_reference_name_mobile_address_first" required placeholder="Juan Dela Cruz / 09171234567 / Quezon City"/></div>
<div class="caf-field full"><label class="caf-label">Reference 2 ‚Äî Name / Mobile / Address <span class="req">*</span></label><input class="caf-input" data-field="principal_reference_name_mobile_address_second" required placeholder="Maria Santos / 09181234567 / Manila"/></div>
<div class="caf-field full"><label class="caf-label">Reference 3 ‚Äî Name / Mobile / Address</label><input class="caf-input" data-field="principal_reference_name_mobile_address_third" placeholder="Pedro Garcia / 09191234567 / Bulacan"/></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê SUCCESS screen ‚ïê‚ïê‚ïê -->
<div class="caf-panel" id="step-success">
<div class="caf-success">
<div class="caf-success-icon">üéâ</div>
<h2>Application Submitted!</h2>
<p>Maraming salamat! Natanggap na namin ang iyong car loan application.</p>
<p>Ang aming team ay mag-contact sayo within 24-48 hours.</p>
<p style="margin-top:16px"><a href="business-package.html" style="color:var(--cp-lime);font-weight:700;text-decoration:underline">‚Üê Back to Business Package</a></p>
</div>
</div>

<!-- Actions -->
<div class="caf-actions" id="cafActions">
<button class="caf-btn caf-btn-back" id="btnBack" onclick="cafPrev()">‚Üê Back</button>
<button class="caf-btn caf-btn-next" id="btnNext" onclick="cafNext()">Next ‚Üí</button>
<button class="caf-btn caf-btn-submit" id="btnSubmit" onclick="cafSubmit()" style="display:none">Submit Application ‚úì</button>
</div>

</article>
</section>

<!-- Footer -->
<div class="cp-footer-embossed" id="pz-footer">All rights reserved by Carpinoy Logistics Services.</div>
</div>
</div>


<footer class="cp-footer">&copy; 2024&ndash;2026 Carpinoy Logistics Services &mdash; All rights reserved. &#x1F1F5;&#x1F1ED;</footer>

<script>
const N=document.getElementById('cpNav');
window.addEventListener('scroll',()=>N.classList.toggle('scrolled',scrollY>40),{passive:true});
const H=document.getElementById('cpHam'),M=document.getElementById('cpMob');
H.addEventListener('click',()=>{const o=M.classList.toggle('open');H.innerHTML=o?'\u2715':'\u2630';});
M.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>{M.classList.remove('open');H.innerHTML='\u2630';}));
</script>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Carpinoy Car Loan Application ‚Äî Multi-Step Form
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

var UNITS = [
  "Mitsubishi L300 FB Exceed Euro4 Dual A/C",
  "Isuzu Traviz L 2.5D UV Dual A/C",
  "Toyota Tamarraw FX Diesel Manual",
  "Isuzu Traviz Reefer Van",
  "Isuzu Traviz Close Van",
  "Isuzu 4-Wheeler Close Van",
  "Isuzu 6-Wheeler Close Van",
  "Kia K2500",
  "Hyundai H100"
];

var BRAND_MAP = {
  "Mitsubishi L300 FB Exceed Euro4 Dual A/C": "Mitsubishi",
  "Isuzu Traviz L 2.5D UV Dual A/C": "Isuzu",
  "Toyota Tamarraw FX Diesel Manual": "Toyota",
  "Isuzu Traviz Reefer Van": "Isuzu",
  "Isuzu Traviz Close Van": "Isuzu",
  "Isuzu 4-Wheeler Close Van": "Isuzu",
  "Isuzu 6-Wheeler Close Van": "Isuzu",
  "Kia K2500": "Kia",
  "Hyundai H100": "Hyundai"
};

var PRIVACY_TEMPLATE = 'DATA PRIVACY ACT WAIVER\n\nTO BE INCLUDED IN AND CONSIDERED PART AND PARCEL OF THE CREDIT APPLICATION FORM AND DOCUMENTS:\n\nI hereby authorize {BRAND} Dealership Branch to process and share my personal data to any of its accredited banks, which is likewise authorized to receive, use, collect and process my personal data, for the purpose of financing my purchase of auto vehicle/s from the dealer or assignment of the dealer\'s rights to its accredited banks, including verification, customer profiling, cross-checking and credit investigation.\n\nIn this regard, my personal information may also be shared with accredited banks\' branches, subsidiaries, affiliates, representative or third party service providers.\n\nI am also aware that the details of how my personal data will be processed and the rights available to me are listed in the accredited banks Privacy Policy Statement, which I may secure from the accredited bank(s) concerned.';

var STEPS = [
  {id:"step-1",label:"Unit"},
  {id:"step-2",label:"Privacy"},
  {id:"step-3",label:"Personal"},
  {id:"step-4",label:"Employment"},
  {id:"step-5",label:"Co-Maker"},
  {id:"step-6",label:"References"}
];

var currentStep = 0;
var selectedUnit = "";
var selectedBrand = "";

/* ‚îÄ‚îÄ Supabase config ‚îÄ‚îÄ */
var SB_URL = "https://yixnlcppzjyxoarghlai.supabase.co";
var SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpeG5sY3Bwemp5eG9hcmdobGFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc1MTkxNTcsImV4cCI6MjA1MzA5NTE1N30.jM9sJFqsJnR1Ti9XD7JhJjj4RjGBJnSq-4u9WT9g-2g";

/* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
function cafInit(){
  // Build unit cards
  var grid = document.getElementById("unitGrid");
  UNITS.forEach(function(u){
    var card = document.createElement("label");
    card.className = "caf-unit-card";
    card.innerHTML = '<input type="radio" name="unit_applying" value="'+u+'"/><span class="caf-unit-dot"></span><span class="caf-unit-name">'+u+'</span>';
    card.querySelector("input").addEventListener("change",function(){
      selectedUnit = u;
      selectedBrand = BRAND_MAP[u] || "";
      document.querySelectorAll(".caf-unit-card").forEach(function(c){c.classList.remove("is-selected")});
      card.classList.add("is-selected");
      hideError();
    });
    grid.appendChild(card);
  });

  // Build step indicators
  renderSteps();
  showStep(0);
}

function renderSteps(){
  var el = document.getElementById("cafSteps");
  el.innerHTML = "";
  STEPS.forEach(function(s,i){
    var cls = "caf-step";
    if(i===currentStep) cls+=" is-active";
    else if(i<currentStep) cls+=" is-done";
    var html = '<div class="'+cls+'"><span class="caf-step-num">'+(i+1)+'</span><span>'+s.label+'</span></div>';
    if(i<STEPS.length-1) html += '<span class="caf-step-line"></span>';
    el.innerHTML += html;
  });
}

function showStep(n){
  currentStep = n;
  STEPS.forEach(function(s,i){
    var panel = document.getElementById(s.id);
    if(panel) panel.classList.toggle("is-active",i===n);
  });
  document.getElementById("step-success").classList.remove("is-active");

  var btnBack = document.getElementById("btnBack");
  var btnNext = document.getElementById("btnNext");
  var btnSubmit = document.getElementById("btnSubmit");
  var actions = document.getElementById("cafActions");

  actions.style.display = "flex";
  btnBack.style.display = n>0 ? "" : "none";
  btnNext.style.display = n<STEPS.length-1 ? "" : "none";
  btnSubmit.style.display = n===STEPS.length-1 ? "" : "none";

  renderSteps();
  hideError();
  window.scrollTo({top:document.getElementById("cafSteps").offsetTop-80,behavior:"smooth"});
}

function showSuccess(){
  STEPS.forEach(function(s){document.getElementById(s.id).classList.remove("is-active")});
  document.getElementById("step-success").classList.add("is-active");
  document.getElementById("cafActions").style.display="none";
  document.getElementById("cafSteps").style.display="none";
}

/* ‚îÄ‚îÄ Validation ‚îÄ‚îÄ */
function showError(msg){
  var el=document.getElementById("cafError");
  el.textContent=msg;el.classList.add("is-visible");
  el.scrollIntoView({behavior:"smooth",block:"center"});
}
function hideError(){document.getElementById("cafError").classList.remove("is-visible")}

function validateStep(n){
  hideError();
  if(n===0){
    if(!selectedUnit){showError("Please select a unit.");return false}
  }
  if(n===1){
    if(!document.getElementById("privacyAccept").checked){showError("Please accept the Data Privacy Waiver to proceed.");return false}
  }
  if(n===2){
    var req=document.querySelectorAll("#step-3 [required]");
    for(var i=0;i<req.length;i++){
      if(!req[i].value.trim()){
        showError("Please fill in all required fields (marked with *).");
        req[i].focus();return false;
      }
    }
  }
  if(n===3){
    var req=document.querySelectorAll("#step-4 [required]");
    for(var i=0;i<req.length;i++){
      if(!req[i].value.trim()){
        showError("Please fill in all required fields.");
        req[i].focus();return false;
      }
    }
  }
  if(n===5){
    var r1=document.querySelector('[data-field="principal_reference_name_mobile_address_first"]');
    var r2=document.querySelector('[data-field="principal_reference_name_mobile_address_second"]');
    if(!r1.value.trim()||!r2.value.trim()){showError("Please provide at least 2 character references.");return false}
  }
  return true;
}

/* ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ */
function cafNext(){
  if(!validateStep(currentStep))return;
  if(currentStep===0){
    // Update privacy text based on selected brand
    var text = PRIVACY_TEMPLATE.replace(/\{BRAND\}/g, selectedBrand);
    document.getElementById("privacyText").textContent = text;
    document.getElementById("privacyAccept").checked = false;
  }
  showStep(currentStep+1);
}

function cafPrev(){
  if(currentStep>0)showStep(currentStep-1);
}

/* ‚îÄ‚îÄ Collect all form data ‚îÄ‚îÄ */
function collectData(){
  var data = {};
  data.unit_applying = selectedUnit;
  data.unit_applied = selectedUnit;
  var brand = selectedBrand.toLowerCase();
  data[brand+"_data_privacy_act"] = true;
  data.status = "pending";
  data.sales_agent = "";
  data.remarks = "";

  document.querySelectorAll("[data-field]").forEach(function(el){
    data[el.getAttribute("data-field")] = el.value.trim();
  });

  // Auto-calc age from birthday
  if(data.principal_birthday){
    try{
      var bd=new Date(data.principal_birthday);
      var now=new Date();
      var age=now.getFullYear()-bd.getFullYear();
      if(now.getMonth()<bd.getMonth()||(now.getMonth()===bd.getMonth()&&now.getDate()<bd.getDate()))age--;
      data.principal_age=String(age);
    }catch(_){}
  }

  return data;
}

/* ‚îÄ‚îÄ Submit ‚îÄ‚îÄ */
async function cafSubmit(){
  if(!validateStep(currentStep))return;

  var btn=document.getElementById("btnSubmit");
  btn.disabled=true;btn.textContent="Submitting...";

  var data=collectData();

  try{
    var res=await fetch(SB_URL+"/rest/v1/carloan_applications",{
      method:"POST",
      headers:{
        "apikey":SB_KEY,
        "Authorization":"Bearer "+SB_KEY,
        "Content-Type":"application/json",
        "Prefer":"return=minimal"
      },
      body:JSON.stringify(data)
    });

    if(!res.ok){
      var err=await res.json().catch(function(){return{}});
      throw new Error(err.message||err.error||"Submission failed");
    }

    showSuccess();
  }catch(e){
    showError("Failed to submit: "+e.message+". Please try again or message us at m.me/carpinoylogistics");
    btn.disabled=false;btn.textContent="Submit Application ‚úì";
  }
}

/* ‚îÄ‚îÄ Auto-age calc on birthday change ‚îÄ‚îÄ */
document.addEventListener("change",function(e){
  if(e.target.getAttribute("data-field")==="principal_birthday"){
    var ageField=document.querySelector('[data-field="principal_age"]');
    if(ageField&&e.target.value){
      try{
        var bd=new Date(e.target.value);var now=new Date();
        var age=now.getFullYear()-bd.getFullYear();
        if(now.getMonth()<bd.getMonth()||(now.getMonth()===bd.getMonth()&&now.getDate()<bd.getDate()))age--;
        ageField.value=age;
      }catch(_){}
    }
  }
});

cafInit();
</script>


<script>
window.CP_CHAT_CONFIG = {
  edgeFnUrl: "https://yixnlcppzjyxoarghlai.supabase.co/functions/v1/carpinoy-ai-chat",
  handoffUrl: "https://m.me/carpinoylogistics",
  requireLead: true
};
</script>
<script src="cp-brad-widget-v2.js"></script>
</body>
</html>
